pipeline {
    agent {label 'georgeJavaNode01'}
    stages {
        stage ('login ocp') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'msaocp', passwordVariable: 'password', usernameVariable: 'username')]){
               sh '''
                    oc login https://api.ocp49.redhat.poc:6443 -u $username -p $password
                    oc project msa
                '''
              }
            }
        }
        stage('clone from SCM') {
            steps {
                dir("/") {
                sh 'rm -rf /msa'
                sh 'git clone git@github.com:george-palsys/msa.git'
                }
            }
        stage ('deploy postgresql-persistent') {
            steps {
               dir("/msa") {
               sh '''
                   ./clean.sh
                   oc apply -f pvclaim.yml
                   oc new-app --name=postgres-database --template=postgresql-persistent --param=DATABASE_SERVICE_NAME=postgres-database --param=POSTGRESQL_USER=sa --param=POSTGRESQL_PASSWORD=sa --param=POSTGRESQL_DATABASE=person 
                '''
               }
              }
            }
        }
        stage('Create Application') { 
            steps {
                 sh '''
                     oc new-app --name=postgres-database --template=postgresql-persistent --param=DATABASE_SERVICE_NAME=postgres-database --param=POSTGRESQL_USER=sa --param=POSTGRESQL_PASSWORD=sa --param=POSTGRESQL_DATABASE=person
                 '''
                }
            }
                        
        stage("synsc javaapp") {
            steps {
                sh echo first test
            }
            }
      }
    }
